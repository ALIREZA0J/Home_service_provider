<!DOCTYPE html>
<html  lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Payment Form with Captcha</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"/>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
      integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk"
      crossorigin="anonymous"
    />
    <style>
      #captcha-container {
        display: flex;
        align-items: center;
        margin-top: 20px;
      }

      #image {
        margin: 0 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 10px 20px;
        font-weight: bold;
        font-size: 1.2em;
        border: 2px solid #ffffff;
        border-radius: 4px;
        user-select: none;
        background-color: #f8f9fa;
        color: #8e35dc;
      }

      #user-input {
        flex: 1;
        display: flex;
        align-items: center;
      }

      #captchaInput {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 10px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        width: 100%;
      }

      .inline {
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      #btn {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        color: #fff;
        margin-top: 20px;
        background-color: #17a2b8;
      }
    </style>
  </head>

  <body>
    <div id="ten-countdown"></div>
    <div method="post">
      <section style="background-color: #c6a0ff">
        <div class="container py-5">
          <div class="row d-flex justify-content-center">
            <div class="col-md-9 col-lg-7 col-xl-5">
              <div class="card">
                <div class="card-body">
                  <div class="card-title d-flex justify-content-between mb-0">
                    <p class="mb-0">$760</p>
                  </div>
                </div>
                <div class="rounded-bottom" style="background-color: darkcyan">
                  <div class="card-body">
                    <p class="mb-4">Your payment details</p>

                    <div class="form-outline mb-3">
                      <input
                        type="text"
                        id="cardNumber"
                        class="form-control"
                        placeholder="Card number"
                      />
                      <label class="form-label" for="cardNumber"
                        >Card Number</label
                      >
                    </div>

                    <div class="col-6">
                      <div class="form-outline">
                        <input
                          type="password"
                          maxlength="6"
                          minlength="3"
                          id="cvv"
                          class="form-control"
                          placeholder="Cvv2"
                        />
                        <label class="form-label" for="cvv">Cvv</label>
                        <input
                          type="text"
                          id="mm"
                          class="form-control"
                          placeholder="MM"
                        />
                        <label class="form-label" for="mm">Month</label>
                        <input
                          type="text"
                          id="yy"
                          class="form-control"
                          placeholder="YY"
                        />
                        <label class="form-label" for="yy">Year</label>
                        <input
                          type="password"
                          maxlength="8"
                          minlength="4"
                          id="password"
                          class="form-control"
                          placeholder="Password"
                        />
                        <label class="form-label" for="password">Password</label>
                      </div>
                    </div>

                    <div id="captcha-container">
                      <input
                        type="text"
                        id="captchaInput"
                        placeholder="Captcha code"
                        class="form-control"
                      />
                      <div class="inline" onclick="generate()">
                        <i class="fas fa-sync"></i>
                      </div>
                      <div id="image" selectable="False"></div>
                    </div>
                    <p id="captchaMessage" style="color: aqua; text-align: center"></p>

                    <button type="button" onclick="submitForm()" class="btn btn-info btn-block">
                      Pay now
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script>
      let captcha;
      function generate() {
        document.getElementById("captchaInput").value = "";
        captcha = document.getElementById("image");
        let uniquechar = "";
        const randomchar =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        for (let i = 1; i < 6; i++) {
          uniquechar += randomchar.charAt(
            Math.floor(Math.random() * randomchar.length)
          );
        }
        captcha.innerHTML = uniquechar;
      }

      function validateCaptcha() {
        const usr_input = document.getElementById("captchaInput").value;
        if (usr_input === captcha.innerHTML) {
          document.getElementById("captchaMessage").innerHTML = "Matched";
          return true;
        } else {
          document.getElementById("captchaMessage").innerHTML = "Not Matched";
          generate();
          return false;
        }
      }

      function submitForm() {
        if (validateCaptcha()) {
          const cardNumber = document.getElementById("cardNumber").value;
          const cvv = document.getElementById("cvv").value;
          const month = document.getElementById("mm").value;
          const year = document.getElementById("yy").value;
          const password = document.getElementById("password").value;
          const url = "http://localhost:8089/user/payment";
          const data = {
            cardNumber,
            cvv,
            month,
            year,
            password,
          };

          fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          })
            .then((response) => {
              if (response.ok) {
                console.log("Success");
              } else {
                console.log("Request failed: " + response.status);
              }
            })
            .catch((error) => {
              console.log("An error occurred: " + error);
            });
        }
      }

      document.addEventListener("DOMContentLoaded", (event) => {
        generate();
      });
    </script>
  </body>
</html>
